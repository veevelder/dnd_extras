Macro:
Name: Start Combat
Image: systems/dnd5e/icons/skills/weapon_01.jpg
Scope: global
Type: script
Command:
if (game.combat) {
	let d = new Dialog({
		title: "Combat Already Started",
		content: "<p>You must end Combat before starting a new one.</p>",
		buttons: {
			one: {
				icon: '<i class="fas fa-check"></i>',
				label: "Ok"
			},
		},
		default: "one",
	}).render(true);
}
else {
	if (canvas.tokens.controlled.length === 0) {
		let d = new Dialog({
			title: "Invalid Choice",
			content: "<p>You must select at least one or more tokens on the map before starting combat.</p>",
			buttons: {
				one: {
					icon: '<i class="fas fa-check"></i>',
					label: "Ok"
				},
			},
			default: "one",
		}).render(true);
	}
	else {
		async function start() {
			for ( let token of canvas.tokens.controlled) {      
				if (token.inCombat === false){
					// Change 'rollNPC' to 'rollAll' if you want to roll for your players as well.
					await token.toggleCombat().then(() => game.combat.rollAll(null, {rollMode: 'gmroll'}));
				}
			}
		}
		start().then(function() {
			//save the currently playing playlist
			CONFIG["OldPlaylist"] = game.playlists.playing
			async function stopAll() {
				game.playlists.playing.forEach(function(playing) {playing.stopAll()});
			}
			stopAll().then(function() {
				let _combat = game.playlists.entities.find(data => data.name == "Combat");
				let _music = _combat.sounds[Math.floor(Math.random() * _combat.sounds.length)];
				// Get the audio data
				let audio = _combat.audio[_music._id];
				// Start playing
				if (!_music.playing) {
					async function load() {
						if (audio.howl.state() !== "loaded")audio.howl.load();
					}
					load().then(function() {
						audio.id = audio.howl.play(audio.id);
						audio.howl.volume(_music.volume * game.settings.get("core", "globalPlaylistVolume"), audio.id);
						audio.howl.loop(_music.repeat, audio.id);
						_music.playing = true;
					});
				}
			});
			game.combat.startCombat();
		});
	}
}